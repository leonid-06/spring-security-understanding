# spring-security-understanding

1) In this lesson we implemented basic project with authentication that comes out of the box Spring Security

We have controller `GET http://localhost:8080/hello` and `default configuration of Spring Security`

And now if we make simple `curl http://localhost:8080/hello` then will get 
`{
"status":401,
"error":"Unauthorized",
"message":"Unauthorized",
"path":"/hello"
}`

Therefore, we need to define basic auth credentials automatically generated by Spring `curl -u user:93a01cf0-794b-4b98-86ef-54860f36f7f3 http://localhost:8080/hello`

The response to the call is

`Hello!`

Also we can use more low level approach
`echo -n user:93a01cf0-794b-4b98-86ef-54860f36f7f3 | base64`
Get `dXNlcjo5M2EwMWNmMC03OTRiLTRiOTgtODZlZi01NDg2MGYzNmY3ZjM=`
`curl -H "Authorization: Basic dXNlcjo5M2EwMWNmMC03OTRiLTRiOTgtODZlZi01NDg2MGYzNmY3ZjM="  localhost:8080/hello`

<img src="src/main/resources/static/spring-sec-class-design.png">

2) In this lesson we will slightly override `out of box logic` added custom UserDetailService implementation (InMemoryUserDetailsManager) and added custom PasswordEncoder implementation

We created user who has a set of credentials (username and password)

Added the user to be managed by our implementation of UserDetailsService

Define a bean of the type PasswordEncoder that our application can use to verify a given password with the one stored and managed by UserDetailsService

`curl -iu leo:pass http://localhost:8080/hello` 200 OK

<img src="src/main/resources/static/part2-changes.png">

3) In this part we will customize the handling of authentication and authorization, by defining a bean of type SecurityFilterChain

It makes sense, I can do it this way, but for some reason it doesn't work.
<img src="src/main/resources/static/part3-changes.png">

4) In this topic, Let's try to create custom AuthProvider (consist and manage user-details and pass-encoder)
5) Today, we impl relly custom user-details-service (not just modified InMemoryUserDetailsService, but implemented own class ... impl UDS).
   
Also let's highlight a few best practice:
* Create UserDetailsServiceImpl and PasswordEncoder in one class, and mark its @Component
* In AuthenticationProviderImpl don't forget to check the password through the passport-encoder-bean, but not just through row.equal(income) method
* While user creating don't forget and encode passwords

<img src="src/main/resources/static/part5-changes.png">

6) In this part we will connect our "Security" with "Data Base" via JdbcUserDetailsManager

For implementation, we will need
* Database driver and SpringJDBC dep
* Create DDL (schema.sql) and DML(data.sql) files in /resources
* Configure app.prop
  <img src="src/main/resources/static/part6-changes-1.png">
* Implements CustomJDBCManager and run.

_In fact, overriding the set... methods is not necessary. This should be done if the column names in your DB do not match the names username password enabled, authority_
We can just write that
```  
@Bean
UserDetailsService userDetailsService(DataSource dataSource){
return new JdbcUserDetailsManager(dataSource);
}
```